<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monarch — The Squad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-body: #0a0a0a;
      --bg-card: #141414;
      --text-main: #ffffff;
      --text-muted: #a1a1aa;
      --accent: #ef4444; /* Neon Red */
      --gold: #D4AF37; /* Gold from the Logo for specific accents */
      --border: rgba(255, 255, 255, 0.1);
      --font-body: 'Inter', sans-serif;
    }

    /* --- RESET --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-body);
      color: var(--text-main);
      font-family: var(--font-body);
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* --- UTILITIES --- */
    .container { max-width: 1000px; margin: 0 auto; padding: 0 24px; }
    
    .btn {
      display: inline-flex; background: var(--accent); color: white;
      padding: 12px 24px; font-weight: 800; text-transform: uppercase; font-size: 11px;
      letter-spacing: 0.05em; text-decoration: none; border-radius: 4px;
      transition: 0.2s; border: none; cursor: pointer;
    }
    .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
    
    .btn-outline {
        background: transparent; border: 1px solid var(--border); color: white;
    }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

    h1 { font-size: 32px; font-weight: 900; letter-spacing: -0.04em; text-transform: uppercase; margin-bottom: 10px; }
    .tagline { color: var(--accent); font-weight: 800; font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase; display: block; margin-bottom: 12px; }

    /* --- NAVIGATION --- */
    nav {
      position: sticky; top: 0; width: 100%; padding: 20px 24px; z-index: 50;
      background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-weight: 900; font-size: 20px; letter-spacing: -0.05em; font-style: italic; color: white; text-decoration: none; }
    
    .nav-links { display: flex; gap: 24px; }
    .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 12px; font-weight: 700; text-transform: uppercase; transition: 0.2s; }
    .nav-links a:hover, .nav-links a.active { color: white; }
    @media(max-width: 768px) { .nav-links { display: none; } }

    /* --- TEAM GRID --- */
    .team-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 30px; margin-top: 60px; margin-bottom: 80px;
    }

    .team-card {
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 8px; overflow: hidden; transition: 0.3s;
        display: flex; flex-direction: column;
    }
    .team-card:hover { transform: translateY(-5px); border-color: var(--accent); }

    .team-img-wrap {
        width: 100%; height: 300px; overflow: hidden; position: relative;
    }
    .team-img {
        width: 100%; height: 100%; object-fit: cover;
        transition: 0.5s; filter: grayscale(100%);
    }
    .team-card:hover .team-img { filter: grayscale(0%); transform: scale(1.05); }

    .team-info { padding: 24px; flex-grow: 1; display: flex; flex-direction: column; }
    .team-role { 
        font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; 
        color: var(--accent); font-weight: 800; margin-bottom: 8px;
    }
    .team-name { font-size: 20px; font-weight: 800; margin-bottom: 4px; color: white; }
    .team-handle { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; font-family: monospace; }
    .team-bio { font-size: 13px; color: var(--text-muted); line-height: 1.6; margin-bottom: 24px; flex-grow: 1; }

    .team-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    
    /* --- FOOTER --- */
    footer { border-top: 1px solid var(--border); padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 12px; }

  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="brand" id="brand_logo">MONARCH</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="services.html">Services</a>
      <a href="team.html" class="active">The Squad</a>
      <a href="contact.html">Contact</a>
    </div>
    <a href="#book" class="btn" onclick="openBooking()">Book Now</a>
  </nav>

  <main class="container" style="padding-top: 60px;">
    
    <div class="text-center" style="max-width: 600px;">
      <span class="tagline">Meet The Team</span>
      <h1>The Squad</h1>
      <p style="color:var(--text-muted);">
        We blend experience with comfort. A space where students, locals, and military members get reliable service without the hassle.
      </p>
    </div>

    <div class="team-grid" id="team_grid">
      <div style="grid-column:1/-1; color:rgba(255,255,255,.6); padding:40px 0;">Loading team...</div>
    </div>

  </main>

  <footer>
    <div class="container">
      <div style="font-weight:900; font-size:20px; font-style:italic; margin-bottom:10px;">MONARCH</div>
      <p>© 2026 Monarch Hair Club. Powered by Net Studio.</p>
    </div>
  </footer>

  <script src="/assets/js/netstudio_booking.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    if (window.lucide) lucide.createIcons();

    /* --- SLUG RESOLVER --- */
    function nsGetSlugFromHost() {
      const qp = new URLSearchParams(location.search).get("b");
      if (qp) return String(qp).trim().toLowerCase();

      const host = (location.hostname || "").toLowerCase();
      if (!host || host === "localhost" || host.startsWith("127.")) return null;

      const ROOT = "netstudiodevelopment.com";
      if (host === ROOT || host === "www." + ROOT) return null;

      if (host.endsWith("." + ROOT)) {
        const slug = host.slice(0, -(ROOT.length + 1)).split(".")[0];
        return slug || null;
      }
      return null;
    }

    function nsShouldUseQuerySlug() {
      const host = (location.hostname || "").toLowerCase();
      return (
        host.endsWith(".pages.dev") ||
        host.endsWith(".workers.dev") ||
        host === "localhost" ||
        host.startsWith("127.")
      );
    }

    function nsLinkWithSlug(targetPath) {
      const slug = window.NS?.BUSINESS_SLUG || nsGetSlugFromHost();
      if (!slug) return targetPath;

      if (!nsShouldUseQuerySlug()) return targetPath;

      const u = new URL(targetPath, location.href);
      u.searchParams.set("b", slug);
      return u.pathname + "?" + u.searchParams.toString() + u.hash;
    }

    /* --- CONFIG --- */
    window.NS = window.NS || {};
    window.NS.SUPABASE_URL = "https://jdvdgvolfmvlgyfklbwe.supabase.co";
    window.NS.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek";
    window.NS.BUSINESS_SLUG = window.NS.BUSINESS_SLUG || nsGetSlugFromHost();

    const sb = supabase.createClient(window.NS.SUPABASE_URL, window.NS.SUPABASE_ANON_KEY);
    const BUSINESS_SLUG = window.NS.BUSINESS_SLUG;

    /* --- BOOKING --- */
    window.openBookingWithStaff = function(staffId) {
      if (typeof window.openBooking !== "function") return;
      window.openBooking({ staff_id: staffId });
    };

    // keep existing API shape for top "Book Now"
    window.openBooking = window.openBooking || function() {
      console.warn("Booking engine not loaded yet.");
    };

    /* --- UI HELPERS --- */
    function escapeHtml(s) {
      return String(s || "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[c]));
    }

    function renderTeam(list) {
      const grid = document.getElementById("team_grid");
      if (!grid) return;

      if (!list.length) {
        grid.innerHTML = `<div style="grid-column:1/-1; color:rgba(255,255,255,.6); padding:40px 0;">
          No active, logged-in team members yet.
        </div>`;
        return;
      }

      grid.innerHTML = "";
      list.forEach(m => {
        const id = (m.id || "").toString();
        const role = escapeHtml(m.role || "Team");
        const name = escapeHtml(m.name || "Staff");
        const bio  = escapeHtml(m.bio || "");
        const handle = escapeHtml(m.specialties || m.email || ""); 
        const img = escapeHtml(
          m.profile_image_url ||
          m.photo_url ||
          "https://images.unsplash.com/photo-1599351431202-1e0f0137899a?auto=format&fit=crop&q=80&w=600"
        );

        grid.insertAdjacentHTML("beforeend", `
          <div class="team-card">
            <div class="team-img-wrap">
              <img src="${img}" class="team-img" alt="${name}">
            </div>
            <div class="team-info">
              <span class="team-role">${role}</span>
              <div class="team-name">${name}</div>
              <div class="team-handle">${handle ? escapeHtml(handle) : ""}</div>
              <p class="team-bio">${bio || "Professional at this location."}</p>
              <div class="team-actions">
                <button class="btn" onclick="openBookingWithStaff('${escapeHtml(id)}')">Book</button>
                <button class="btn btn-outline" onclick="openProfile('${escapeHtml(id)}')">Profile</button>
              </div>
            </div>
          </div>
        `);
      });
    }

    async function loadBusinessAndTeam() {
      const grid = document.getElementById("team_grid");
      if (!BUSINESS_SLUG) {
        if (grid) grid.innerHTML = `<div style="grid-column:1/-1; color:rgba(255,255,255,.6); padding:40px 0;">Business not found.</div>`;
        return;
      }

      // update logo link + page links with slug
      const brand = document.getElementById("brand_logo");
      if (brand) brand.setAttribute("href", nsLinkWithSlug("index.html"));
      document.querySelectorAll(".nav-links a[href]").forEach(a => {
        const href = a.getAttribute("href");
        if (href && !href.startsWith("http") && !href.startsWith("#")) {
          a.setAttribute("href", nsLinkWithSlug(href));
        }
      });

      const { data: biz, error: bErr } = await sb
        .schema("public")
        .from("business")
        .select("id, name")
        .eq("slug", BUSINESS_SLUG)
        .maybeSingle();

      if (bErr || !biz?.id) {
        if (grid) grid.innerHTML = `<div style="grid-column:1/-1; color:rgba(255,255,255,.6); padding:40px 0;">Unable to load business.</div>`;
        return;
      }

      // logo text = business name
      if (brand && biz.name) brand.textContent = String(biz.name).toUpperCase();

      // ✅ RULE: only team members that are active AND logged in
      const { data: members, error: mErr } = await sb
        .schema("public")
        .from("team_members")
        .select("id, name, role, bio, photo_url, profile_image_url, email, specialties, auth_user_id, is_active, created_at")
        .eq("business_id", biz.id)
        .eq("is_active", true)
        .not("auth_user_id", "is", null)
        .order("created_at", { ascending: true });

      if (mErr) {
        console.warn("team_members error:", mErr);
        if (grid) grid.innerHTML = `<div style="grid-column:1/-1; color:rgba(255,255,255,.6); padding:40px 0;">Unable to load team.</div>`;
        return;
      }

      renderTeam(members || []);
    }

    // your existing profile stub
    function openProfile(teamMemberId) {
      console.log("Navigating to profile for:", teamMemberId);
    }
    window.openProfile = openProfile;

    loadBusinessAndTeam();
  </script>
</body>
</html>
