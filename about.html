<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monarch — About Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    window.nsOpenBooking = window.nsOpenBooking || function(payload = {}) {
      if (window.NetStudio && typeof window.NetStudio.open === "function") return window.NetStudio.open(payload);
      if (typeof window.openBooking === "function") return window.openBooking(payload);
      console.warn("Booking engine loading...");
    };
  </script>

  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-body: #0a0a0a;
      --bg-card: #141414;
      --text-main: #ffffff;
      --text-muted: #a1a1aa;
      --accent: #ef4444; /* Neon Red */
      --border: rgba(255, 255, 255, 0.1);
      --font-body: 'Inter', sans-serif;
    }

    /* --- RESET --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-body);
      color: var(--text-main);
      font-family: var(--font-body);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* --- UTILITIES --- */
    .container { max-width: 1000px; margin: 0 auto; padding: 0 24px; }
    
    .btn {
      display: inline-flex; background: var(--accent); color: white;
      padding: 12px 24px; font-weight: 800; text-transform: uppercase; font-size: 11px;
      letter-spacing: 0.05em; text-decoration: none; border-radius: 4px;
      transition: 0.2s; border: none; cursor: pointer;
    }
    .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
    
    h1 { font-size: 42px; font-weight: 900; letter-spacing: -0.04em; text-transform: uppercase; margin-bottom: 20px; line-height: 1; }
    h2 { font-size: 28px; font-weight: 800; text-transform: uppercase; margin-bottom: 16px; }
    
    .tagline { color: var(--accent); font-weight: 800; font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase; display: block; margin-bottom: 12px; }
    .text-body { color: var(--text-muted); font-size: 15px; margin-bottom: 20px; }

    /* --- NAVIGATION --- */
    nav {
      position: sticky; top: 0; width: 100%; padding: 20px 24px; z-index: 50;
      background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-weight: 900; font-size: 20px; letter-spacing: -0.05em; font-style: italic; color: white; text-decoration: none; }
    .nav-links { display: flex; gap: 24px; }
    .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 12px; font-weight: 700; text-transform: uppercase; transition: 0.2s; }
    .nav-links a:hover, .nav-links a.active { color: white; }
    @media(max-width: 768px) { .nav-links { display: none; } }

    /* --- HERO --- */
    .page-hero {
      padding: 100px 0 60px; border-bottom: 1px solid var(--border);
    }

    /* --- CONTENT BLOCKS --- */
    .split-section {
      display: grid; grid-template-columns: 1fr 1fr; gap: 60px; 
      padding: 80px 0; border-bottom: 1px solid var(--border); align-items: center;
    }
    .split-reverse { direction: rtl; } 
    .split-reverse > * { direction: ltr; }
    
    @media(max-width: 768px) { 
      .split-section { grid-template-columns: 1fr; gap: 40px; padding: 60px 0; }
      .split-reverse { direction: ltr; }
      .img-frame { order: -1; }
    }

    .img-frame {
      width: 100%; aspect-ratio: 4/3; background: #222; 
      position: relative; border: 1px solid var(--border);
    }
    .img-frame img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); }
    
    /* "EST 2021" Badge */
    .est-badge {
      display: inline-block; padding: 8px 16px; border: 1px solid var(--accent);
      color: var(--accent); font-weight: 800; font-size: 12px; margin-bottom: 20px;
      letter-spacing: 0.1em;
    }

    /* --- MAP SECTION --- */
    .map-section { padding: 80px 0; text-align: center; }
    .map-frame {
      width: 100%; height: 400px; background: #222; margin-top: 40px;
      border: 1px solid var(--border); filter: grayscale(100%);
    }

    /* --- FOOTER --- */
    footer { border-top: 1px solid var(--border); padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 12px; }

  </style>
</head>
<body>

  <nav>
    <a href="index.html" class="brand" id="nav_logo">MONARCH</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="services.html">Services</a>
      <a href="team.html">The Squad</a>
      <a href="about.html" class="active">About</a>
    </div>
    <a href="#book" class="btn" onclick="window.nsOpenBooking(); return false;">Book Now</a>
  </nav>

  <main class="container">
    
    <div class="page-hero">
      <div class="est-badge">EST. 2021</div>
      <h1 id="about_heading">Authentic<br>Norfolk Spirit.</h1>
      <p class="text-body" style="max-width: 500px; font-size: 18px; color: white;" id="bio_text">
        The Monarch Hair Club isn't just where you get lined up, it's where you feel at home.
      </p>
    </div>

    <div class="split-section">
      <div>
        <span class="tagline" id="story_kicker">Our Story</span>
        <h2 id="story_title">More Than A Cut</h2>
        <p class="text-body" id="story_p1">
          For years, our chair has been a place for conversation, connection, and community. 
          From catching up on the latest news to sharing life stories, this is where people come 
          to relax, laugh, and walk out feeling confident.
        </p>
        <p class="text-body" id="story_p2">
          We are built on the belief that a fresh cut isn't just about the look. 
          It's about the experience.
        </p>
      </div>
      <div class="img-frame">
        <img id="about_img" src="https://images.unsplash.com/photo-1532710093739-9470acff878f?auto=format&fit=crop&q=80&w=800" alt="Barber Chair">
      </div>
    </div>

    <div class="split-section split-reverse">
      <div>
        <span class="tagline" id="extra_kicker">The Shop</span>
        <h2 id="extra_title">Heart of Norfolk</h2>
        <p class="text-body" id="extra_p1">
          Right here on Colley Ave, The Monarch Hair Club is known for its welcoming atmosphere 
          and top-notch service.
        </p>
        <p class="text-body" id="extra_p2">
          Our space blends classic barber traditions with a modern touch. Whether you're here 
          for a sharp fade, a clean shave, or just to talk sports and life—Monarch is always ready for you.
        </p>
      </div>
      <div class="img-frame">
        <img id="extra_img" src="https://images.unsplash.com/photo-1503951914875-befbb711ed3e?auto=format&fit=crop&q=80&w=800" alt="Shop Interior">
      </div>
    </div>

    <div class="map-section">
      <span class="tagline">The Community</span>
      <h2>Built For The People</h2>
      <p class="text-body" style="max-width: 600px; margin: 0 auto;">
        We pride ourselves on being a spot where everyone is welcome. 
        It's a second home. Every cut comes with good vibes, good company, and that authentic Norfolk spirit.
      </p>

      <div class="map-frame">
        <iframe id="map_frame" width="100%" height="100%" frameborder="0" style="border:0" src=""></iframe>
      </div>
      
      <div style="margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div>
            <h4 style="color:white; margin-bottom:8px;">Location</h4>
            <p class="text-body" style="font-size:14px;" id="contact_address">Loading Address...</p>
        </div>
        <div>
            <h4 style="color:white; margin-bottom:8px;">Hours</h4>
            <p class="text-body" style="font-size:14px;" id="contact_hours">Loading Hours...</p>
        </div>
      </div>

    </div>

  </main>

  <footer>
    <div class="container">
      <div id="footer_logo" style="font-weight:900; font-size:20px; font-style:italic; margin-bottom:10px;">MONARCH</div>
      <p id="footer_copy">© 2026 Monarch Hair Club. Powered by Net Studio.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    if (window.lucide) lucide.createIcons();

    /* --- UTILS --- */
    function nsGetSlug() {
      const q = new URLSearchParams(location.search).get("b");
      if (q) return q.toLowerCase();
      const h = location.hostname.toLowerCase();
      const R = "netstudiodevelopment.com";
      if (!h || h === "localhost" || h.startsWith("127.") || h === R || h === "www." + R) return null;
      if (h.endsWith("." + R)) return h.slice(0, -(R.length + 1)).split(".")[0];
      return null;
    }

    function nsSetBusinessContext(businessId) {
      if (!businessId) return;
      window.NS_BUSINESS_ID = businessId;
      document.documentElement.setAttribute("data-business-id", businessId);
      if (document.body) document.body.setAttribute("data-business-id", businessId);
      try {
        localStorage.setItem("ns_business_id", businessId);
        sessionStorage.setItem("ns_business_id", businessId);
      } catch(e) {}
      try {
        const u = new URL(location.href);
        if (!u.searchParams.get("business_id")) {
          u.searchParams.set("business_id", businessId);
          history.replaceState({}, "", u.toString());
        }
      } catch(e) {}
    }

    function nsLoadBookingEngine() {
      return new Promise((resolve) => {
        if (window.openBooking || (window.NetStudio && typeof window.NetStudio.open === "function")) return resolve(true);
        const s = document.createElement("script");
        s.src = "/netstudio_booking.js";
        s.async = true;
        s.onload = () => resolve(true);
        s.onerror = () => resolve(false);
        document.body.appendChild(s);
      });
    }

    /* --- CONTENT HELPERS --- */
    function setText(id, val){
      const el = document.getElementById(id);
      if (!el) return;
      if (val === undefined || val === null) return;
      const s = String(val).trim();
      if (!s) return;
      el.textContent = s;
    }

    function setHTML(id, val){
      const el = document.getElementById(id);
      if (!el) return;
      if (val === undefined || val === null) return;
      const s = String(val).trim();
      if (!s) return;
      el.innerHTML = s;
    }

    function setImg(id, url){
      const el = document.getElementById(id);
      if (!el) return;
      const s = (url || "").toString().trim();
      if (!s) return;
      el.src = s;
    }

    function pickFirst(obj, keys){
      if (!obj) return "";
      for (const k of keys) {
        const v = obj[k];
        if (v !== undefined && v !== null && String(v).trim() !== "") return v;
      }
      return "";
    }

    /* --- CANONICAL ABOUT INJECTION --- */
    function applyAboutCanonicalMonarch(content){
      const about = content?.about || {};

      // HERO
      const hero = about.hero || {};
      const heroHeading = pickFirst(hero, ["heading", "title", "h1"]);
      const heroText    = pickFirst(hero, ["text", "subtitle", "lead", "body", "description"]);
      const heroImg     = pickFirst(hero, ["image_url", "img", "image", "bg", "bg_url", "photo_url"]);

      if (heroHeading) setHTML("about_heading", heroHeading);
      if (heroText) setHTML("bio_text", heroText);
      if (heroImg) setImg("about_img", heroImg);

      // STORY
      const story = about.story || {};
      const storyKicker = pickFirst(story, ["kicker", "tagline", "label"]);
      const storyTitle  = pickFirst(story, ["title", "heading"]);
      const storyP1     = pickFirst(story, ["p1", "paragraph_1", "paragraph1", "text_1", "text1"]);
      const storyP2     = pickFirst(story, ["p2", "paragraph_2", "paragraph2", "text_2", "text2"]);

      if (storyKicker) setText("story_kicker", storyKicker);
      if (storyTitle)  setText("story_title", storyTitle);
      if (storyP1)     setText("story_p1", storyP1);
      if (storyP2)     setText("story_p2", storyP2);

      // SECTION EXTRA
      const extra = about.section_extra || {};
      const extraKicker = pickFirst(extra, ["kicker", "tagline", "label"]);
      const extraTitle  = pickFirst(extra, ["title", "heading"]);
      const extraP1     = pickFirst(extra, ["p1", "paragraph_1", "paragraph1", "text_1", "text1"]);
      const extraP2     = pickFirst(extra, ["p2", "paragraph_2", "paragraph2", "text_2", "text2"]);
      const extraImg    = pickFirst(extra, ["image_url", "img", "image", "bg", "bg_url", "photo_url"]);

      if (extraKicker) setText("extra_kicker", extraKicker);
      if (extraTitle)  setText("extra_title", extraTitle);
      if (extraP1)     setText("extra_p1", extraP1);
      if (extraP2)     setText("extra_p2", extraP2);
      if (extraImg)    setImg("extra_img", extraImg);
    }

    /* --- FORMATTERS --- */
    function formatTime(t) {
      if(!t) return "";
      const [h, m] = t.split(":");
      const H = parseInt(h);
      const ampm = H >= 12 ? "PM" : "AM";
      const H12 = H % 12 || 12;
      return `${H12}:${m} ${ampm}`;
    }

    const SORTER = { "sunday":0, "monday":1, "tuesday":2, "wednesday":3, "thursday":4, "friday":5, "saturday":6 };
    const DAYS = { "sunday":"Sun", "monday":"Mon", "tuesday":"Tue", "wednesday":"Wed", "thursday":"Thu", "friday":"Fri", "saturday":"Sat" };

    /* --- MAIN LOAD --- */
    const SB_URL = "https://jdvdgvolfmvlgyfklbwe.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek";
    const sb = supabase.createClient(SB_URL, SB_KEY);
    const SLUG = nsGetSlug();

    async function loadMonarchAbout() {
      if (!SLUG) return;

      // 1. Business Info (Only ID/Branding/Address)
      // Removed 'bio' from select
      const { data: biz } = await sb.from("business")
        .select("id, name, street_address, city, state")
        .eq("slug", SLUG).maybeSingle();
      
      if (!biz) return;

      // Context & Engine
      nsSetBusinessContext(biz.id);
      await nsLoadBookingEngine();

      // Branding
      if (biz.name) {
        const n = biz.name.toUpperCase();
        if(document.getElementById("nav_logo")) document.getElementById("nav_logo").textContent = n;
        if(document.getElementById("footer_logo")) document.getElementById("footer_logo").textContent = n;
        if(document.getElementById("footer_copy")) document.getElementById("footer_copy").textContent = `© ${new Date().getFullYear()} ${biz.name}. Powered by Net Studio.`;
      }

      // Address & Map
      const address = [biz.street_address, biz.city, biz.state].filter(Boolean).join(", ");
      if(document.getElementById("contact_address")) {
        document.getElementById("contact_address").innerHTML = address.replace(", ", "<br>");
      }

      if (address) {
        const q = encodeURIComponent(address);
        document.getElementById("map_frame").src = `http://googleusercontent.com/maps.google.com/maps?q=${q}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
      }

      // 2) Follow pointer (business_sites_one) -> active template
      let activeKey = "monarch_v1";
      const { data: one, error: oneErr } = await sb
        .from("business_sites_one")
        .select("active_template_key")
        .eq("business_id", biz.id)
        .maybeSingle();

      if (oneErr) console.error(oneErr);
      if (one?.active_template_key) activeKey = one.active_template_key.trim();

      // 3) Fetch active site row content
      const { data: site, error: siteErr } = await sb
        .from("business_sites")
        .select("template_key, content_json")
        .eq("business_id", biz.id)
        .eq("template_key", activeKey)
        .maybeSingle();

      if (siteErr) console.error(siteErr);

      // ✅ Content_json ONLY injection
      if (site?.content_json) {
        applyAboutCanonicalMonarch(site.content_json);
      }

      // 4. Fetch Hours
      const { data: hours } = await sb.from("business_hours")
        .select("day_of_week, open_time, close_time, is_closed")
        .eq("business_id", biz.id);

      const hoursEl = document.getElementById("contact_hours");
      if (hours && hours.length > 0) {
        hours.sort((a, b) => SORTER[a.day_of_week] - SORTER[b.day_of_week]);
        let html = "";
        hours.forEach(h => {
          const dayName = DAYS[h.day_of_week];
          const timeStr = h.is_closed ? "Closed" : `${formatTime(h.open_time)} - ${formatTime(h.close_time)}`;
          html += `${dayName}: ${timeStr}<br>`;
        });
        hoursEl.innerHTML = html;
      }
    }

    loadMonarchAbout();
  </script>
</body>
</html>
