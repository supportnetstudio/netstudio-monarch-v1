<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>About — Powered by Net Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    window.nsOpenBooking = window.nsOpenBooking || function(payload = {}) {
      if (window.NetStudio && typeof window.NetStudio.open === "function") return window.NetStudio.open(payload);
      console.warn("Booking engine loading...");
    };
  </script>

  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-body: #0a0a0a;
      --bg-card: #141414;
      --text-main: #ffffff;
      --text-muted: #a1a1aa;
      --accent: #ef4444; 
      --border: rgba(255, 255, 255, 0.1);
      --font-body: 'Inter', sans-serif;
    }

    /* --- RESET --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg-body);
      color: var(--text-main);
      font-family: var(--font-body);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* --- UTILITIES --- */
    .container { max-width: 1000px; margin: 0 auto; padding: 0 24px; }
    
    .btn {
      display: inline-flex; background: var(--accent); color: white;
      padding: 12px 24px; font-weight: 800; text-transform: uppercase; font-size: 11px;
      letter-spacing: 0.05em; text-decoration: none; border-radius: 4px;
      transition: 0.2s; border: none; cursor: pointer;
    }
    .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
    
    h1 { font-size: 42px; font-weight: 900; letter-spacing: -0.04em; text-transform: uppercase; margin-bottom: 20px; line-height: 1; }
    h2 { font-size: 28px; font-weight: 800; text-transform: uppercase; margin-bottom: 16px; }
    
    .tagline { color: var(--accent); font-weight: 800; font-size: 11px; letter-spacing: 0.2em; text-transform: uppercase; display: block; margin-bottom: 12px; }
    .text-body { color: var(--text-muted); font-size: 15px; margin-bottom: 20px; }

    /* --- NAVIGATION --- */
    nav {
      position: sticky; top: 0; width: 100%; padding: 20px 24px; z-index: 50;
      background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-weight: 900; font-size: 20px; letter-spacing: -0.05em; font-style: italic; color: white; text-decoration: none; }
    .nav-links { display: flex; gap: 24px; }
    .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 12px; font-weight: 700; text-transform: uppercase; transition: 0.2s; }
    .nav-links a:hover, .nav-links a.active { color: white; }
    @media(max-width: 768px) { .nav-links { display: none; } }

    /* --- HERO --- */
    .page-hero { padding: 100px 0 60px; border-bottom: 1px solid var(--border); }

    /* --- CONTENT BLOCKS --- */
    .split-section {
      display: grid; grid-template-columns: 1fr 1fr; gap: 60px; 
      padding: 80px 0; border-bottom: 1px solid var(--border); align-items: center;
    }
    .split-reverse { direction: rtl; } 
    .split-reverse > * { direction: ltr; }
    
    @media(max-width: 768px) { 
      .split-section { grid-template-columns: 1fr; gap: 40px; padding: 60px 0; }
      .split-reverse { direction: ltr; }
      .img-frame { order: -1; }
    }

    .img-frame {
      width: 100%; aspect-ratio: 4/3; background: #222; 
      position: relative; border: 1px solid var(--border);
    }
    .img-frame img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); }
    
    .est-badge {
      display: inline-block; padding: 8px 16px; border: 1px solid var(--accent);
      color: var(--accent); font-weight: 800; font-size: 12px; margin-bottom: 20px;
      letter-spacing: 0.1em;
    }

    /* --- MAP SECTION --- */
    .map-section { padding: 80px 0; text-align: center; }
    .map-frame {
      width: 100%; height: 400px; background: #222; margin-top: 40px;
      border: 1px solid var(--border); filter: grayscale(100%);
    }

    /* --- FOOTER --- */
    footer { border-top: 1px solid var(--border); padding: 40px 0; text-align: center; color: var(--text-muted); font-size: 12px; }

    #site-error { display: none; text-align: center; padding: 100px 20px; color: #666; font-size: 14px;}
  </style>
</head>
<body id="about">

  <div id="site-error"><h2>404</h2><p>Business not found.</p></div>

  <div id="main-content" style="opacity: 0; transition: opacity 0.5s ease;">
    <nav>
      <a href="index.html" class="brand" id="nav_logo">MONARCH</a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="services.html">Services</a>
        <a href="team.html">The Squad</a>
        <a href="about.html" class="active">About</a>
      </div>
      <a href="#book" class="btn" onclick="nsOpenBooking(); return false;">Book Now</a>
    </nav>

    <main class="container">
      
      <div class="page-hero">
        <div class="est-badge" id="hero_kicker"></div>
        <h1 id="hero_headline"></h1>
        <p class="text-body" style="max-width: 500px; font-size: 18px; color: white;" id="hero_body"></p>
      </div>

      <div class="split-section">
        <div>
          <span class="tagline" id="story_kicker"></span>
          <h2 id="story_title"></h2>
          <p class="text-body" id="story_p1"></p>
          <p class="text-body" id="story_p2"></p>
        </div>
        <div class="img-frame">
          <img id="story_img" src="" alt="About Monarch">
        </div>
      </div>

      <div class="split-section split-reverse">
        <div>
          <span class="tagline" id="extra_kicker"></span>
          <h2 id="extra_title"></h2>
          <p class="text-body" id="extra_body"></p>
        </div>
        <div class="img-frame">
          <img id="extra_img" src="" alt="The Shop">
        </div>
      </div>

      <div class="map-section">
        <span class="tagline" id="community_kicker"></span>
        <h2 id="community_title"></h2>
        <p class="text-body" style="max-width: 600px; margin: 0 auto;" id="community_body"></p>

        <div class="map-frame">
          <iframe id="map_frame" width="100%" height="100%" frameborder="0" style="border:0" src=""></iframe>
        </div>
        
        <div style="margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
          <div>
              <h4 style="color:white; margin-bottom:8px;">Location</h4>
              <p class="text-body" style="font-size:14px;" id="contact_address">Loading Address...</p>
          </div>
          <div>
              <h4 style="color:white; margin-bottom:8px;">Hours</h4>
              <p class="text-body" style="font-size:14px;" id="contact_hours">Loading Hours...</p>
          </div>
        </div>
      </div>

    </main>

    <footer>
      <div class="container">
        <div id="footer_logo" style="font-weight:900; font-size:20px; font-style:italic; margin-bottom:10px;">MONARCH</div>
        <p id="footer_copy"></p>
      </div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    (() => {
      const $ = (id) => document.getElementById(id);
      const pick = (...vals) => vals.find(v => v !== undefined && v !== null && String(v).trim() !== "") || "";

      function nsDetectSlug() {
        const ROOT = "netstudiodevelopment.com";
        const host = (location.hostname || "").toLowerCase();
        if (!host || host === ROOT || host === "www." + ROOT) return null;
        if (host.endsWith("." + ROOT)) return host.slice(0, -(ROOT.length + 1)).split(".")[0];
        return new URLSearchParams(location.search).get("b");
      }

      const NS = {
        SB_URL: "https://jdvdgvolfmvlgyfklbwe.supabase.co",
        SB_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek",
        SLUG: nsDetectSlug(),
        TEMPLATE: "monarch_v1"
      };

      const sb = supabase.createClient(NS.SB_URL, NS.SB_KEY);

      function nsLoadBookingEngine() {
        return new Promise((resolve) => {
          if (window.NetStudio && typeof window.NetStudio.open === "function") return resolve(true);
          const s = document.createElement("script");
          s.src = "/netstudio_booking.js";
          s.async = true;
          s.onload = () => resolve(true);
          document.body.appendChild(s);
        });
      }

      function formatTime(t) {
        if(!t) return "";
        const [h, m] = t.split(":");
        const H = parseInt(h);
        const ampm = H >= 12 ? "PM" : "AM";
        const H12 = H % 12 || 12;
        return `${H12}:${m} ${ampm}`;
      }

      const SORTER = { "sunday":0, "monday":1, "tuesday":2, "wednesday":3, "thursday":4, "friday":5, "saturday":6 };
      const DAYS = { "sunday":"Sun", "monday":"Mon", "tuesday":"Tue", "wednesday":"Wed", "thursday":"Thu", "friday":"Fri", "saturday":"Sat" };

      function apply(data, biz) {
        const about = data.about || {};
        const hero = about.hero || {};
        const story = about.story || {};
        const extra = about.section_extra || {};
        const community = about.community || {};

        const bName = biz.name || "MONARCH";
        if($("nav_logo")) $("nav_logo").textContent = bName.toUpperCase();
        if($("footer_logo")) $("footer_logo").textContent = bName.toUpperCase();
        if($("footer_copy")) $("footer_copy").textContent = `© ${new Date().getFullYear()} ${bName}. Powered by Net Studio.`;

        // Hero
        if($("hero_kicker")) $("hero_kicker").textContent = pick(hero.kicker, "EST. 2021");
        if($("hero_headline")) $("hero_headline").innerHTML = pick(hero.headline, "Authentic<br>Norfolk Spirit.");
        if($("hero_body")) $("hero_body").textContent = pick(hero.body, biz.bio, "");

        // Section 1: Story
        if($("story_kicker")) $("story_kicker").textContent = pick(story.kicker, "Our Story");
        if($("story_title")) $("story_title").textContent = pick(story.title, "More Than A Cut");
        if($("story_p1")) $("story_p1").textContent = pick(story.body_p1, "");
        if($("story_p2")) $("story_p2").textContent = pick(story.body_p2, "");
        if($("story_img")) $("story_img").src = pick(story.image, "https://images.unsplash.com/photo-1532710093739-9470acff878f?auto=format&fit=crop&q=80&w=800");

        // Section 2: Extra
        if($("extra_kicker")) $("extra_kicker").textContent = pick(extra.kicker, "The Shop");
        if($("extra_title")) $("extra_title").textContent = pick(extra.headline, "Heart of Norfolk");
        if($("extra_body")) $("extra_body").textContent = pick(extra.body, "");
        if($("extra_img")) $("extra_img").src = pick(extra.image, "https://images.unsplash.com/photo-1503951914875-befbb711ed3e?auto=format&fit=crop&q=80&w=800");

        // Section 3: Community
        if($("community_kicker")) $("community_kicker").textContent = pick(community.kicker, "The Community");
        if($("community_title")) $("community_title").textContent = pick(community.title, "Built For The People");
        if($("community_body")) $("community_body").textContent = pick(community.body, "");

        // Map & Contact
        const addr = [biz.street_address, biz.city, biz.state].filter(Boolean).join(", ");
        if($("contact_address")) $("contact_address").innerHTML = addr.replace(", ", "<br>");
        if($("map_frame")) $("map_frame").src = `https://maps.google.com/maps?q=${encodeURIComponent(addr)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;

        $("main-content").style.opacity = "1";
      }

      async function init() {
        if (!NS.SLUG) { if($("site-error")) $("site-error").style.display = "block"; return; }
        const { data: biz } = await sb.from("business").select("*").eq("slug", NS.SLUG).maybeSingle();
        if (!biz) { if($("site-error")) $("site-error").style.display = "block"; return; }

        window.NS_BUSINESS_ID = biz.id;
        await nsLoadBookingEngine();

        const [siteRes, hoursRes] = await Promise.all([
          sb.from("business_sites").select("content_json").eq("business_id", biz.id).eq("template_key", NS.TEMPLATE).maybeSingle(),
          sb.from("business_hours").select("*").eq("business_id", biz.id)
        ]);

        const hoursEl = $("contact_hours");
        if (hoursEl && hoursRes.data) {
          const sorted = hoursRes.data.sort((a, b) => SORTER[a.day_of_week] - SORTER[b.day_of_week]);
          hoursEl.innerHTML = sorted.map(h => {
            const dayName = DAYS[h.day_of_week];
            const timeStr = h.is_closed ? "Closed" : `${formatTime(h.open_time)} - ${formatTime(h.close_time)}`;
            return `${dayName}: ${timeStr}<br>`;
          }).join("");
        }

        apply(siteRes.data?.content_json || {}, biz);
      }
      init();
    })();
  </script>
</body>
</html>
